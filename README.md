# üì® multi-broker-core

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —è–¥—Ä–æ –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ Node.js / Nest.js.  
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –±—Ä–æ–∫–µ—Ä–∞–º–∏: RabbitMQ, Kafka, Redis Streams, HTTP callbacks.  
–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π (—á–µ—Ä–µ–∑ in-memory transport).

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
npm install multi-broker-core
```

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** `MessageTransport` –¥–ª—è –≤—Å–µ—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞** `MessageEnvelope` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
  - `id`
  - `timestamp`
  - `correlationId`
  - `source`
  - `idempotencyKey`
  - `headers`
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏**: `ack`, `nack`, `retry`, `dlq`.
- **–ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫**: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫.
- **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** (`delay API`).
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** —Å –∫–ª—é—á–æ–º –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º.
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ (OpenTelemetry), –º–µ—Ç—Ä–∏–∫–∏.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
  - batch-–ø—É–±–ª–∏–∫–∞—Ü–∏—è,
  - prefetch,
  - backpressure.
- **HealthCheck API** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.
- **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ–ø—Ü–∏–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**:
  - `routingKey`
  - `partitionKey`
  - `ttl`
  - `priority`
  - `headers`
  - `contentType`

---

## üîç –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å

- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø—É–±–ª–∏–∫–∞—Ü–∏—è, –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ, –æ—à–∏–±–∫–∏, `correlationId`.
- **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞**: –æ–±—ë—Ä—Ç–∫–∞ `publish/consume` –≤ OpenTelemetry spans.
- **–ú–µ—Ç—Ä–∏–∫–∏**: `ack` / `nack` / `retry` / `dlq`, latency –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–≤–∫–ª—é—á–∞—Ç—å –∏ –≤—ã–∫–ª—é—á–∞—Ç—å** –ª–æ–≥–∏, —Ç—Ä–µ–π—Å–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ –æ–ø—Ü–∏–∏.

---

## üß© –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å—Ö–µ–º—ã

- **–§–æ—Ä–º–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: JSON.  
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã**: Avro, Protobuf.  
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º**: —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Zod –∏–ª–∏ TypeBox).  
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Schema Registry**:
  - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º,
  - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏: `content-type`, `x-schema-id`, `x-schema-version`.  
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã,
  - —Å—Ç—Ä–æ–≥–∞—è —ç–≤–æ–ª—é—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤,
  - –º–µ–∂—ä—è–∑—ã–∫–æ–≤–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **Batch-–ø—É–±–ª–∏–∫–∞—Ü–∏—è** (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Kafka, fallback –≤ core).
- **Backpressure**: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- **Prefetch –∏ flow-control**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–ø–∞—É–∑—ã –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –ø–æ–¥–ø–∏—Å–æ–∫.

---

## üõ†Ô∏è Error Handling

- **ErrorClassifier** –¥–ª—è –≥–∏–±–∫–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫.  
- **HandlerResult** —Å–æ–¥–µ—Ä–∂–∏—Ç:  
  - `status`  
  - `errorCode`  
  - `errorMessage`  
  - `errorType`  
  - `details`  
  - `dlqReason`  
  - `headers`  
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–æ–∫:  
  - `4xx ‚Üí nack/ack`  
  - `5xx/timeout ‚Üí retry`.  
- DLQ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ –ø–æ–ª—è –¥–ª—è –ø–æ–Ω—è—Ç–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

---

## ‚ù§Ô∏è HealthCheck API

- –ú–µ—Ç–æ–¥ `MessagingService.healthCheck()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å:  
  - `healthy`  
  - `degraded`  
  - `unhealthy`  
- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç:
  - **`isHealthy()`** ‚Äî –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –ª–∞–≥, –±—É—Ñ–µ—Ä—ã).  
  - **`info()`** ‚Äî –¥–µ—Ç–∞–ª–∏ (–≤–µ—Ä—Å–∏—è –±—Ä–æ–∫–µ—Ä–∞, –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –ø–∞—Ä—Ç–∏—Ü–∏—è—Ö, –æ—á–µ—Ä–µ–¥—å, —É–∑–µ–ª).  

---

## üõ£Ô∏è Roadmap

- **NestJS-–º–æ–¥—É–ª—å**: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `forRoot`, interceptors, health checks.  
- **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—ã**: RabbitMQ, Kafka, Redis, HTTP.
